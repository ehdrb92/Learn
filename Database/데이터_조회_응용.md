# 데이터 조회 응용 SQL문(MYSQL 기준)

```sql
SELECT {열}, {연산열} AS {별명} FROM {테이블};
SELECT {열}, {연산열} AS {별명} FROM {테이블} WHERE {연산열을 이용한 조건} ORDER BY {별명} [DESC|ASC];
SELECT 함수({열1}, {열2}) FROM {테이블};
```

테이블에 존재하는 열을 산술 연산자를 이용하여 연산한 열을 만들어서 함께 조회할 수 있다. 산술 연산은 수치형 데이터(int, float, ...)에만 적용가능하다.

각 열을 "+", "-", "*", "/", "%"의 산술 연산자를 이용하여 연산 가능

연산열은 조회할 때 열의 이름이 "{열1}+{열2}-{열3}"과 같이 연산자가 포함된 이름으로 지정된다. 이를 AS를 사용해서 별명을 정해 조회할 수 있다.

WHERE 구에서는 별명을 사용하여 조건을 만들 수 없다. 왜냐하면 SQL문이 서버 내부에서 처리되는 순서가 다음과 같기 때문이다.

- "WHERE 구" -> "SELECT 구" -> "ORDER BY 구"

별명은 SELECT 구에서 지정되는데 WHERE 구는 SELECT 구보다 먼저 처리되므로 별명을 사용할 수 없다.

산술 연산자 대신에 함수를 사용하는 것도 가능하다. 함수는 다음과 같은 것들이 존재한다.

- **ROUND({열}, {반올림 자리})**: 특정 열을 특정 자리만큼 반올림한다. 반올림 자리를 설정하지않으면 기본적으로 소수점 첫째 자리(0)를 기준으로 반올림한다.
- **CONCAT({열1}, {열2}, ...)**: 지정된 열들을 결합한다. 해당 함수는 문자열을 결합한다.
- **SUBSTRING({열}, {시작지점}, {끝지점})**: 지정된 열을 정해진 시작지점부터 끝지점까지 추출한다. 첫 번째 문자는 0이 아닌 1부터 시작한다.
- **TRIM({열})**: 지정된 열 데이터의 공백을 제거한다.
- **CHARACTER_LENGTH({열})**: 지정된 열 데이터의 문자길이를 반환한다.

```sql
SELECT {열}
CASE {조건열}
  WHEN {조건1} THEN {결과1}
  WHEN {조건2} THEN {결과2}
  WHEN {조건3} THEN {결과3}
  ELSE {결과4}
END
FROM {테이블};
```

CASE 문을 이용해서 조건열의 데이터를 특정 다른 데이터로 치환할 수 있다. CASE 문 내부의 특정 WHEN 구의 조건에 참일 경우 THEN 구의 결과 값으로 치환하여 조회한다.

ELSE는 어떤 조건에도 해당하지 않을 경우 치환되는 값이다. ELSE를 생략가능하며 생략할 경우 기본값인 NULL이 적용된다.

```sql
SELECT COUNT(*) FROM {테이블};
SELECT COUNT({열1}), COUNT({열2}) FROM {테이블};
SELECT COUNT(DISTINCT {열1}) FROM {테이블};
```

위는 함수의 인수로 집합을 사용하는 집계함수이다. COUNT() 집계함수의 경우 {집합}란에 "*"를 사용할 수 있다. COUNT() 집계함수의 경우 특정 행을 지정했을 때, 행의 데이터로 NULL이 있으면 개수를 세지 않고 제외시킨다.

COUNT() 함수의 인수로 제공되는 열에 DISTINCT 구를 추가하여 중복을 제거한 개수 조회가 가능하다.

```sql
SELECT SUM({열}) FROM {테이블};
SELECT AVG({열}) FROM {테이블};
SELECT MAX({열}) FROM {테이블};
SELECT MIN({열}) FROM {테이블};
```

SUM(), AVG(), MAX(), MIN()은 각각 합계, 평균, 최댓값, 최솟값을 구하는 집계함수이다.

```sql
SELECT AVG((CASE WHEN {열} IS NULL THEN 0 ELSE {열} END)) FROM {테이블};
```

집계함수를 사용할 때 NULL 값은 연산에 포함되지 않는다고 하였다. 만약 평균을 구하려는 열에 NULL 데이터가 있는데 이를 0으로 취급하여 평균 연산에 포함시키고자 한다면 위와 같이 사용할 수 있다.

```sql
SELECT COUNT({열}) FROM {테이블} GROUP BY {열};
SELECT {열}, COUNT({열}) FROM {테이블} GROUP BY {열};
SELECT COUNT({열1}), SUM({열2}) FROM {테이블} GROUP BY {열1}, {열2};
```

GROUP BY 구를 이용해서 특정 열의 데이터를 기준으로 같은 값을 가진 데이터끼리 묶어서 집합으로 만들어 집계함수의 인수로 전달한다. GROUP BY는 집계함수의 인수를 그룹화하기위한 구이므로 집계함수에 사용하지 않으면 의미가 없다.

```sql
SELECT {열}, COUNT({열}) FROM {테이블} GROUP BY {열} HAVING {집계함수 조건};
```

그룹화된 데이터의 조회에 대해서 조건을 적용하려하려면 HAVING 구를 사용해야 한다. WHERE 구의 경우 GROUP BY 구보다 빠르게 처리되므로 그룹화가 적용된 데이터에는 적용되지 않는다.

- "WHERE 구" -> "GROUP BY 구" -> "HAVING 구" -> "SELECT 구" -> "ORDER BY 구"