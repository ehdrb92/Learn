## 쿠버네티스 핵심 개념

- Pod: 쿠버네티스에서 생성하고 관리하는 가장 작은 배포 단위. 파드는 보통 단일 컨테이너로 동작하는 경우가 많지만 함께 작동해야하는 여러 컨테이너를 포함하기도 한다.
- Service: 파드 집합에서 실행되는 애플리케이션을 네트워크 서비스로 노출하는 방법.
- Deployment: 애플리케이션을 배포할 방법에 대한 설명. 이를 사용하여 애플리케이션을 배포하면 쿠버네티스는 해당 상태를 유지하기 위해 동작한다. 파드의 개수, 에러가 발생했을 때 자기수복 등을 한다.
- Node: 쿠버네티스가 컨테이너를 실행하는 물리적 또는 가상 머신. 각 노드는 파드를 배치할 수 있는 개별의 서버이다. 쿠버네티스는 노드의 상태를 항상 점검하며, 애플리케이션을 배포할 충분한 리소스가 있는지를 확인한다.

## 쿠버네티스 구조

![kubernetes-cluster-architecture](kubernetes-cluster-architecture.svg)

- Master Node: 쿠버네티스 클러스터의 전체 애플리케이션을 관리하는 역할
- Worker Node: 애플리케이션이 호스팅되는 서버

### kubelet

쿠버네티스 Control Plane과 컨테이너를 실행하는 노드 사이의 다리 역할을 하는 필수 구성 요소. 컨테이너가 파드 스펙에 정의된 대로 실행되고 있는지 확인한다. kubelet은 다음과 같은 방식으로 동작한다.

1. 쿠버네티스 API 서버로부터 파드가 실행되는 방법과 포함해야 하는 내용을 설명하는 파드스펙을 받는다. 컨테이너, 볼륨 및 기타 설정에 대한 정보를 포함한다.
2. 주요 작업은 각 노드에 파드들이 스펙에 맞게 실행되고 있는지 확인하는 것이다. 스펙에 맞게 실행되고 있지 않다면 스펙에 맞는 상태를 유지하기 위해 수정을 한다.
3. 노드에 있는 파드의 리소스 사용량(CPU, 메모리 등)을 모니터링하고 이 정보를 마스터 노드에 보고한다. 스케쥴링 결정 내리고 리소스를 효율적으로 활용하기 위함이다.
4. 파드의 라이프사이클에 맞게 시작, 중지, 재시작 작업을 한다.
5. 레지스트리에서 컨테이너 이미지 가져오기, 볼륨 마운트, 파드 네트워크 구성 등의 작업도 한다.

kubelet은 Continer Runtime Interface(CRI)를 사용하여 노드의 컨테이너 런타임(docker, containerd 등)과 상호 작용한다. 이러한 추상화를 통해 쿠버네티스는 각 런타임에 대해 명시적으로 설계할 필요 없이 여러 컨테이너 런타임을 지원한다.

### Control Plane

컨트롤 플레인은 쿠버네티스 클러스터의 두뇌와 같다. 애플리케이션 스케쥴링과 같은 전역 결정, 클러스터 이벤트를 감지 및 대응하는 일을 담당한다.

- kube-apiserver: 모든 요청을 수신하고 처리한다. 쿠버네티스 API를 노출하고 외부 및 내부 통신이 이루어지는 게이트웨이 역할을 한다.
- etcd: 클러스터의 기본 데이터베이스로 모든 구성 및 상태 정보를 저장한다. 키-값 저장소이다.
- kube-scheduler: 리소스 가용성, 제약 조건 및 기타 정책에 따라 요청된 파드를 실행하야 하는 노드를 결정한다. 작업이 노드 전체에 고르게 분산되도록 한다.
- kube-controller-manager: 클러스터 상태를 조절하는 다양한 컨트롤러를 감독하여 현재 상태가 사용자가 원하는 상태와 일치하는지 확인한다.
- cloud-controller-manager: 클라우드 서비스와의 상호작용을 관리한다.

### Kubernetes API

- API 서버로서의 역할. 클러스터의 모든 작업은 kubectl 사용자, 내부 구성 요소 또는 외부 애플리케이션에 의해 트리거되는지 여부에 관계없이 해당 API 호출에 의해 수행된다.
- CRUD 작업. 파드, 서비스, 배포와 같은 모든 리소스에 대한 생성, 읽기, 업데이트, 삭제 작업을 지원한다.
- 선언적 구성 수신. yaml 또는 json 파일에 정의된 선언적 구성을 확인하여 이와 일치하게 작동시키기 위해 동작한다.

### kube-proxy

노드 수준에서 작동하는 쿠버네티스 구성 요소. 네트워크 통신이 원활하고 효율적으로 이루어질 수 있도록 클러스터 내의 서비스에 대한 네트워크 라우팅 및 로드 밸런싱 역할 수행. 서비스에 향하는 트래픽이 클러스터 내 위치에 관계없이 적절한 파드로 올바르게 전달될 수 있도록 도움.

- 쿠버네티스 서비스가 파드 집합에 접근하는 방식을 추상화하여 파드가 변경되더라도 일정하게 유지되는 IP 주소와 포트 번호를 제공하면 kube-proxy가 이를 이용하여 네트워크 트래픽 라우팅을 관리
- 쿠버네티스 서비스가 생성되면 새 서비스 및 관련 엔드포인트에 대한 알림을 kube-proxy가 수신.
- 트래픽에 대한 간단한 로드 밸런싱 수행.