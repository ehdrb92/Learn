## MQTT

MQTT(Message Queuing Telemetry Transport)는 사물 인터넷(IoT)에 사용되는 경량 메세징 프로토콜. 제한된 리소스를 가진 디바이스가 효율적으로 통신하고 데이터를 교환할 수 있게 해주는 기술이다.

기존 client-server 모델과는 다른 publish-subscribe 모델을 기반으로 한다. 핵심 구성 요소는 다음과 같다.

- Publisher: 메시지를 보내는 장치
- Subscriber: 메시지를 수신하는 장치
- Broker: 게시되는 모든 메시지를 필터링하여 구독자에게 배포하는 중앙 허브

## MQTT 동작 메커니즘

1. 연결: 구독자는 TCP/IP 프로토콜을 사용하여 브로커와 연결을 설정한다. 이 연결은 암호화된 통신을 위해 SSL/TLS로 보호할 수 있다.
2. 구독: 구독자가 브로커에 특정 토픽을 구독하도록 요청한다.
3. 게시: 게시자가 브로커에게 메시지에 토픽을 태그하여 보낸다.
4. 브로커: 브로커는 메시지를 수신한 뒤 해당 토픽을 구독하는 모든 구독자에게 메시지를 배포한다.

## Topic과 QoS

- Topic: 메시지를 분류하는 데 사용된다. 계층구조(ex: "home/bathroom/temperature")로 구독을 세밀하게 제어할 수 있다.
- Quality of Service(Qos): 메시지 전송 보장 수준을 정의한다.
  - QoS 0: 메시지가 확인 없이 단 한 번만 전달된다.
  - QoS 1: 메시지가 최소 한 번 이상 전달되며 확인 과정을 거친다.
    - 브로커가 메시지를 수신했다는 승인 메시지를 게시자가 받지 못했다면 재전송한다.
  - QoS 2: 4단계 핸드셰이크를 사용하여 메시지가 정확하게 한 번 전달된다.

### QoS 2의 4단계 핸드셰이크

- 게시: 게시자가 고유 패킷 식별자를 포함하여 메시지 전송
- 수신 확인(PUBREC): 브로커는 메시지가 수신되었지만 아직 처리되지 않았음을 의미하는 메시지 응답
- 릴리스: 게시자는 브로커가 프로세스 완료를 확인하면 메시지를 삭제할 준비가 되었을을 알리는 PUBREL 메시지 전달
- 완료: 브로커가 게시자에게 PUBCOMP를 전송하여 메시지가 구독자에게 전달되었음을 알리고 구독자는 메시지를 폐기

## 사용사례

대역폭이 낮거나 불안정한 네트워크 상황에서 많이 사용

- 환경 모니터링의 원격 센서 데이터 전송
- 조명, 난방 또는 장치 제어를 위한 홈 자동화 시스템
- 장치 간 통신을 위한 산업용 IoT 애플리케이션