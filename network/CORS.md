CORS(Cross-origin resource sharing)는 특정 도메인 외부에 있는 리소스에 대한 액세스를 제어하기 위해 웹 브라우저에 구현된 보안 기능입니다. 기술적인 세부 사항을 살펴보기 전에 개념을 더 잘 이해하기 위해 비유를 들어보겠습니다.

각 집이 인터넷에서 서로 다른 도메인을 나타내는 게이트 커뮤니티에 살고 있다고 상상해 보세요. 이제 이웃집(다른 도메인)에서 잔디 깎는 기계를 빌리고 싶다고 가정해 보겠습니다. 현실 세계에서는 이웃의 집에 들어가 잔디 깎는 기계를 빌리려면 이웃의 허락을 받아야 합니다. CORS는 디지털 영역에서도 유사하게 작동합니다.

### 기술 분석

1. **동일 출처 정책**: 기본적으로 웹 브라우저는 Same-origin policy(SOP)이라는 보안 조치를 시행합니다. SOP는 한 출처에서 로드된 문서나 스크립트가 다른 출처의 리소스와 상호 작용하는 방식을 제한합니다. 출처는 URL의 스키마(프로토콜), 호스트(도메인), 포트로 정의됩니다. 이 중 하나라도 다르면 다른 오리진으로 간주됩니다.

2. **CORS의 역할**: CORS는 웹 페이지의 제한된 리소스를 첫 번째 리소스가 제공된 도메인 외부의 다른 도메인에서 요청할 수 있도록 하는 메커니즘입니다. 이를 통해 웹 서버는 다른 출처의 웹 페이지에서 리소스에 액세스할 수 있도록 허용할 수 있습니다.

3. **CORS 작동 방식**: 웹 페이지가 다른 출처에서 리소스를 가져오려고 하면 브라우저는 요청 사이트의 도메인을 포함하는 추가 헤더인 'Origin'을 사용하여 대상 서버에 HTTP 요청을 보냅니다. 그러면 서버는 CORS 정책에 따라 요청을 허용할지 거부할지 결정할 수 있습니다. 서버가 요청을 허용하는 경우 응답에 `Access-Control-Allow-Origin` 헤더를 포함하여 응답합니다. 이 헤더는 허용된 오리진을 나열하거나 와일드카드(`*`)를 사용하여 모든 도메인을 허용할 수 있습니다.

4. **Preflight Requests**: 특정 유형의 요청의 경우 브라우저는 실제 요청 전에 예비 'Preflight' 요청을 보냅니다. Preflight 요청은 OPTIONS 메서드를 사용하여 서버의 CORS 정책을 확인하여 실제 요청이 허용되는지 확인합니다. 여기에는 실제 요청이 사용할 방법과 헤더를 서버에 알리기 위해 `Access-Control-Request-Method` 및 `Access-Control-Request-Headers`와 같은 헤더가 포함됩니다.

5. **Simple Requests vs. Preflighted Requests**: 모든 요청이 Preflight되는 것은 아닙니다. 특정 유형의 헤더가 포함된 기본 GET 또는 POST와 같은 '단순 요청'은 Preflight가 트리거되지 않습니다. 그러나 요청이 GET, HEAD 또는 POST 이외의 메서드를 사용하거나 CORS에서 기본적으로 허용하지 않는 헤더 또는 콘텐츠 유형을 포함하는 경우 Preflight 요청이 이루어집니다.

### 실제 예시

비유로 돌아가서 이웃집(다른 도메인)에서 잔디 깎는 기계(리소스 액세스)를 빌리려면 먼저 담장 너머로 소리쳐서(Preflight Requests) 괜찮냐고 물어봅니다. 이웃이 아는 사람인지, 이전에 물건을 빌려간 적이 있는지 확인합니다(CORS 정책). 상대방이 동의하면, `Access-Control-Allow-Origin`이라는 서버 응답을 보내며 허락을 합니다. 이제 잔디 깎는 기계를 빌릴 수 있습니다(실제 리소스 액세스 요청).
